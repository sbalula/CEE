% ****** Start of file .tex ******
%
%   This file is based on apssamp.tex, part of the APS files in the REVTeX 4.1 distribution.
%   Version 4.1r of REVTeX, August 2010
%
%   Copyright (c) 2009, 2010 The American Physical Society.
%   Samuel Balula, Pedro Ribeiro, Luís Macedo, Eduardo Neto 2013
%   See the REVTeX 4 README file for restrictions and more information.
%
% TeX'ing this file requires that you have AMS-LaTeX 2.0 installed
% as well as the rest of the prerequisites for REVTeX 4.1
%
% See the REVTeX 4 README file
% It also requires running BibTeX. The commands are as follows:
%
%  1)  latex filename.tex
%  2)  bibtex filename
%  3)  latex filename.tex
%  4)  latex filename.tex

\documentclass[%
  reprint,
  %superscriptaddress,
  %groupedaddress,
  %unsortedaddress,
  %runinaddress,
  %frontmatterverbose, 
  %preprint,
  %showpacs,preprintnumbers,
  nofootinbib,
  %nobibnotes,
  %bibnotes,
  amsmath,amssymb,
  aps,
  %pra,
  %prb,
  %rmp,
  %prstab,
  %prstper,
  %floatfix,
  10pt,
  a4paper
]{revtex4-1}

\if11
% Usual (decimal) numbering
\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand{\thesubsubsection}{\thesubsection.\arabic{subsubsection}}

% Fix references
\makeatletter
\renewcommand{\p@subsection}{}
\renewcommand{\p@subsubsection}{}
\makeatother

\fi

\usepackage{listings}
\usepackage{color}
\usepackage{facil}                      % Pacote pessoal
\usepackage{verbatim}                   % Apresentação de código
\usepackage{graphicx}                   % Include figure files
\usepackage{dcolumn}                    % Align table columns on decimal point
\usepackage{bm}                         % bold math
\usepackage[latin1,utf8]{inputenc}      % Tipos de caracteres
\usepackage[portuges]{babel}            % Português
\usepackage{indentfirst}                % Identação da primeira linha
\usepackage{hyperref}                   % add hypertext capabilities
\usepackage{float}                      %Fixar imagens
%\usepackage[mathlines]{lineno}          % Enable numbering of text and display math
%\linenumbers\relax                      % Commence numbering lines
%\usepackage[compact]{titlesec}

\usepackage[%showframe,%Uncomment any one of the following lines to test 
%%scale=0.7, marginratio={1:1, 2:3}, ignoreall, % default settings
%%text={7in,10in},centering,
margin=0.5in,        %diminuir margens
%total={6.5in,8.75in}, top=1.2in, left=0.9in, 
includefoot
%height=10in,a5paper,hmargin={3cm,0.8in},
]{geometry}

\begin{document}
%\preprint{APS/123-QED}
%\captionsetup[table]{font=small,skip=0pt}
%\captionsetup[figure]{font=small,skip=0pt}
%\titlespacing{\section}{0pt}{*0}{*0}            %Poupar espaço
%\titlespacing{\subsection}{0pt}{*0}{*0}
%\titlespacing{\subsubsection}{0pt}{*0}{*0}

\lstset{language=Matlab,%
    %basicstyle=\color{red},
	belowcaptionskip=1\baselineskip,
	frame=L,
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Início %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
 

\title{Controlo por retroacção do estado de um braço robot flexível}
\thanks{Relatório do trabalho de laboratório}
\author{Alexandre Aparício}
\email{73252, alexandre.aparicio@tecnico.ulisboa.pt}

\author{Pedro Ribeiro}%
\email{73221, pedro.q.ribeiro@tecnico.ulisboa.pt}
\author{Samuel Balula}%
\email{72735, samuel.balula@tecnico.ulisboa.pt}

\affiliation{
  Instituto Superior Técnico\\
  Mestrado em Engenharia Física Tecnológica\\
  Controlo em Espaço de Estados
}

\collaboration{Grupo 4 de 4ª feira}

\date{\today}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Abstract %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
Neste trabalho de laboratório procede-se ao dimensionamento de um controlador por realimentação de variáveis de estado de uma barra flexível actuada por um motor dc, aproximada por um sistema linear, que inclui um observdor assimptótico e seguimento de referência.
O modelo é testado em {\it simulink}, recorrendo tanto a simulações como utilizando o sistema real.
Apresentam-se neste documento os dados experimentais e as respostas às questões laboratoriais.
\end{abstract}
\maketitle


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Introdução %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Cálculo da matriz de controlabilidade}

De acordo com as informações dadas no enunciado, tomando como vector de estado $x$ dado por \eqref{x} as matrizes do modelo de estado linearizado na forma \eqref{lin} são dadas por \eqref{A}, \eqref{B}, \eqref{C}.

\eq[x]{x = \begin{bmatrix}
		x_1 &x_2 &x_3 &x_4 
\end{bmatrix} = \begin{bmatrix}
\theta & \alpha & \dot\theta& \dot\alpha
\end{bmatrix}}

\eq[lin]{\begin{cases}
	\dot x = A x + b u \\
	y = C x
\end{cases}}



\eq[A]{A = \begin{bmatrix}
		0	&0		&1		&0	\\
		0	&0		&0		&1	\\
		0	&566	&-37	&0	\\
		0	&-922	&37		&0	
\end{bmatrix}
}

\eq[B]{b= \begin{bmatrix}
		0 \\
		0\\
		65\\
		-65
\end{bmatrix}}

\eq[C]{c = \begin{bmatrix}
		1 &1	&0	&0
	\end{bmatrix}
}

Pode assim escrever-se a matrix de controlabilidade como \eqref{contr}, calculada em {\it Matlab} como se descreve em \rlis{list1}.

\eq[contr]{\begin{array}{rcl}
		\mathcal{C} &= &
		\begin{bmatrix}
			b &A b & A^2 b & A^3 b
		\end{bmatrix}\\
		&= &
		\begin{bmatrix}
			0         &65       &-2405       &52195 \\
			0         &-65        &2405      &-29055\\
			65       &-2405       &52195     &-569985\\
			-65        &2405      &-29055     &-286195
		\end{bmatrix}
	\end{array}
}

Determinou-se que o sistema é controlável (a dimensão da matriz de controlabilidade é igual ao número de variáveis de estado).

\begin{lstlisting}[label=list1, caption={Código Matlab para o cálculo da matrix de controlabilidade $\mathcal{C}$ e de observabilidade $\mathcal{O}$. {\it cntr} e {\it obsr} adquirem valores booleanos, que indicam se o sistema é controlável e/ou observável, respectivamente. As funções controlab e observab apresentam-se em anexo em ficheiros com o mesmo nome.}]
[C,cntr]=controlab(A,b);
[O,obsr]=observab(A,c);
\end{lstlisting}


\section{Cálculo da matriz de observabilidade}
A matrix de observabilidade é dada por \eqref{obsr}, calculada em {\it Matlab} como se descreve em \rlis{list1}.


\eq[obsr]{\begin{array}{rcl}
		\mathcal{O} &= &
		\begin{bmatrix}
			c \\
			c A\\
			c A^2\\
			c A^3
		\end{bmatrix}\\
		&= &
		\begin{bmatrix}
			1     &1    &0     &0\\
			0     &0     &1     &1\\
			0  &-356     &0     &0\\
			0     &0     &0  &-356
		\end{bmatrix}
	\end{array}
}
Determinou-se que o sistema é observável (a dimensão da matriz de observabilidade é igual ao número de variáveis de estado).

\section{Diagrama de Bode}
\fig{../img/BodeMalhaAberta.png}{Diagrama de Bode do sistema em cadeira aberta}

Através do diagrama de Bode da \rfig{../img/BodeMalhaAberta.png} é possível concluir que o sistema possui 4 pólos, tal como esperado. O motor DC introduz dois pólos reais\cite{dcmotor} e a barra dois pólos complexos conjugados, característicos de um movimento oscilatório amortecido.

POLOS
EXPLICAÇÃO EXISTENCIA

\section{Cálculo do vector de ganhos do controlador e observador}
No cálculo dos ganhos do controlador e observador utilizou-se a função {\it ganhos}, que recebe como argumentos as matrizes de controlabilidade $\mathcal{C}$, observabilidade $\mathcal{O}$ e da dinâmica $A$, e os valores próprios desejados para o controlador e observador, retornando os ganhos calculados com a fórmula de Bass-Gura, conforme se explicita em \rlis{list2}.

Determinaram-se assim os ganhos, explicitados em \eqref{ganhoK} e \eqref{ganhoL}.
\eq[ganhoK]{
	K = \begin{bmatrix}
	6.0501	&-30.5345	&1.0297	&-0.0933
	\end{bmatrix}
}

\eq[ganhoL]{
	L = 
	\begin{bmatrix}
		33.5\\
		89.5\\
		-1161.2\\
		5088.2
	\end{bmatrix}
	}

\begin{lstlisting}[label=list2, caption={Código Matlab para o cálculo dos ganhos $K$ do controlador e $L$ do observador a partir das matrizes de controlabilidade $\mathcal{C}$, observabilidade $\mathcal{O}$ e da dinâmica $A$, e os valores próprios desejados para o controlador $vpp\_C$ e observador $vpp\_O$. A função {\it ganhos} apresenta-se em anexo no ficheiro com o mesmo nome.}]
[K,L]=ganhos(C,vpp_C,O,vpp_O,A);
\end{lstlisting}
\subsection{Verificação com teorema de separação}
??

\section{Simulação em {\it Simulink}}

\section{Função de transferência em cadeira fechada}
%Determinou-se o diagrama de Bode do sistema em cadeia fechada. 
A união entre o modelo em cadeia aberta e o estimador que irão formar o sistema em cadeia fechada é realizada pela função ligacao, que recebe as matrizes do sistema em malha aberta e do estimador em malha aberta e retorna uma variável em formato sys que descreve o sistema (representado em espaço de de estados) como representado no esquema de simulink.

\fig{../img/BodeMalhaFechada.png}{Diagrama de Bode do sistema em cadeira fechada}

\section{Ensaio com o sistema real}

\section{Resposta sem filtro na saída}

\section{Efeito da variação do polo do pré-filtro}

\section{Ensaio sem sinal do extensómetro}

\section{Ensaios com outras especificações para os pólos do observador e/ou controlador}

\section{Conclusões e Críticas}
\label{s:conclu}
%Incluir melhorias propostas à experiência

%\begin{acknowledgments}
%\end{acknowledgments}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % % % % % % % % % % % % % % %     FIM    % % % % % % % % % % % % % % % % % % % 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\nocite{}
\bibliography{bibliografia}{}
\bibliographystyle{plain}% Produces the bibliography via BibTeX.
\end{document}
%end of file
